CREATE DATABASE QUANLYLAODONG
 ON  PRIMARY 
( NAME = N'QuanLyLaoDong', FILENAME = N'F:\Java\QuanLyLaoDong2.mdf' , SIZE = 8192KB , MAXSIZE = UNLIMITED, FILEGROWTH = 65536KB )
 LOG ON 
( NAME = N'QuanLyLaoDong_log', FILENAME = N'F:\Java\QuanLyLaoDong2_log.ldf' , SIZE = 8192KB , MAXSIZE = 2048GB , FILEGROWTH = 65536KB )
 go
 use QUANLYLAODONG
 CREATE TABLE LAODONG(MALD NVARCHAR(50) NOT NULL,TENLAODONG NVARCHAR(50),GIOITINH BIT,NGAYSINH DATE,NGAYLAMVIEC DATE,TRANGTHAI BIT,DIACHI NVARCHAR(50),SDT NVARCHAR(20),CMND NVARCHAR(50),MACM NVARCHAR(50))
 GO
 CREATE TABLE CONGTRINH(MACT NVARCHAR(50) NOT NULL,TENCT NVARCHAR(50),TRANGTHAI BIT,NGAYCAP DATE,NGAYKHOICONG DATE,NGAYDUKIEN DATE,DIADIEM NVARCHAR(50),SOLUONGLD INT)
 GO
 CREATE TABLE CHITIETCT(MACT NVARCHAR(50) NOT NULL,MALD NVARCHAR(50) NOT NULL,NGAYBATDAY DATE,NGAYKETTHUC DATE)
 GO
 CREATE TABLE CHUYENMON(MACM NVARCHAR(50) NOT NULL,TENCM NVARCHAR(50))
 GO
 CREATE TABLE QUANLY(MAQL NVARCHAR(50) NOT NULL,TENQL NVARCHAR(50),SDT NVARCHAR(20),TAIKHOAN VARCHAR(50) NOT NULL,MATKHAU VARCHAR(50) NOT NULL)
 GO
 ALTER TABLE QUANLY ADD CONSTRAINT PK_MAQL PRIMARY KEY(MAQL)
 ALTER TABLE CHUYENMON ADD CONSTRAINT PK_MACM PRIMARY KEY (MACM)
 ALTER TABLE CONGTRINH ADD CONSTRAINT PK_MACT PRIMARY KEY(MACT)
 ALTER TABLE LAODONG ADD CONSTRAINT PK_MALD PRIMARY KEY(MALD)
 ALTER TABLE LAODONG ADD CONSTRAINT FK_MACM FOREIGN KEY (MACM) REFERENCES CHUYENMON(MACM)
 ALTER TABLE CHITIETCT ADD CONSTRAINT PK_MACHUNG PRIMARY KEY(MACT,MALD)
 ALTER TABLE CHITIETCT ADD CONSTRAINT FK_MACT FOREIGN KEY(MACT) REFERENCES CONGTRINH(MACT)
 ALTER TABLE CHITIETCT ADD CONSTRAINT FK_MALD FOREIGN KEY(MALD) REFERENCES LAODONG(MALD)
 GO
 SET DATEFORMAT DMY
 INSERT INTO CHUYENMON VALUES('CM01','GIAM SAT THI CONG'),('CM02','CHI HUY CONG TRINH'),('CM03','THIET KE XAY DUNG'),('CM04','NHAN VIEN XAY DUNG')
 INSERT INTO LAODONG VALUES('NV001','TRAN MANH THIN',0,'05-11-2000','9-5-2021',1,'102 LE LOI','0375013091','312466592','CM02'),
 ('NV002','VO DANG KHOA',0,'09-11-2000','9-5-2021',1,'NGUYEN THAI SON','0333666668','312464129','CM02'),
 ('NV003','PHAM NGOC SON',0,'11-12-2000','9-5-2021',1,'NGUYEN VAN NGHI','0348706679','312464126','CM03'),
 ('NV004','NGUYEN MINH KHANH',0,'13-11-2000','9-5-2021',1,'NGUYEN THAI SON','0347851321','312464127','CM01'),
 ('NV005','NGUYEN HOAI NAM',0,'09-08-2000','9-5-2021',1,'NGUYEN THAI SON','0369325421','312464127','CM03'),
 ('NV006','NGUYEN HUYNH SANG',0,'18-11-2000','9-5-2021',1,'NGUYEN THAI SON','0478512041','124564127','CM04'),
 ('NV007','CHU BAO AN',0,'26-05-2000','9-5-2021',1,'NGUYEN THAI SON','0333624569','312467827','CM04'),
 ('NV008','NGUYEN LE HUYNH NHU',1,'27-11-2000','9-5-2021',1,'NGUYEN THAI SON','0333620033','312464127','CM04'),
 ('NV009','PHUNG THI HANG',1,'18-06-2000','9-5-2021',1,'NGUYEN THAI SON','0333620003','856964127','CM04'),
 ('NV010','DU THANH QUANG',0,'16-07-2000','9-5-2021',1,'NGUYEN THAI SON','0333625823','312464127','CM04'),
 ('NV011','MAI VAN MINH',0,'03-11-2000','9-5-2021',1,'NGUYEN THAI SON','0333624713','021464127','CM04'),
 ('NV012','DUONG THUY LINH',1,'02-06-2000','9-5-2021',1,'NGUYEN THAI SON','0333627721','019464567','CM04'),
 ('NV013','LE NGUYEN BINH NGUYEN',0,'01-11-2000','9-5-2021',1,'NGUYEN THAI SON','0333627721','895464127','CM04'),
 ('NV014','DINH TUAN ANH',0,'06-08-2000','9-5-2021',1,'NGUYEN THAI SON','0333627721','212464128','CM04'),
 ('NV015','NGUYEN VU LAM DUY',0,'22-09-2000','9-5-2021',1,'NGUYEN THAI SON','0335896321','315864129','CM04'),
 ('NV016','NGUYEN DANH HUY',0,'11-12-2000','9-5-2021',1,'NGUYEN THAI SON','0373623256','345664159','CM04'),
 ('NV017','PHAM CONG MINH',0,'23-08-2000','9-5-2021',1,'NGUYEN THAI SON','0373623256','312464186','CM04'),
 ('NV018','CHU THANH SON',0,'18-01-2000','9-5-2021',1,'NGUYEN THAI SON','0383624789','312464196','CM04'),
 ('NV019','CAO VAN TOAN',0,'29-01-2000','9-5-2021',1,'NGUYEN THAI SON','0393627789','012460003','CM01'),
 ('NV020','PHAN TRUNG HIEU',0,'30-03-2000','9-5-2021',1,'NGUYEN THAI SON','0393627789','012460003','CM03')

 INSERT INTO CONGTRINH VALUES('CT001','CHUNG CU CAO TANG',1,'7-10-2020','11-5-2021','31-7-2022','HOANG HOA THAM',5)
			INSERT INTO CONGTRINH VALUES('CT002','BIET THU',1,'15-11-2020','11-5-2021','28-9-2022','NGUYEN VAN NGHI',5)
					INSERT INTO CONGTRINH VALUES('CT003','WC CONG CONG',0,'22-12-2020','11-5-2021','31-5-2022','NGUYEN VAN BAO',5)
						INSERT INTO CONGTRINH VALUES('CT004','NHA AN CONG NHAN',0,'23-10-2020','11-5-2021','30-6-2022','LE LOI',5)
						INSERT INTO CONGTRINH VALUES('CT005','SAN CHOI THIEU NHI',0,'24-10-2020','11-5-2021','30-10-2022','GO VAP',5)
							
 INSERT INTO CHITIETCT VALUES('CT001','NV001','11-5-2021','15-8-2022'),('CT001','NV002','11-5-2021','15-8-2022')
 INSERT INTO QUANLY VALUES('QL','TRAN MANH THIN','0375013091','thintran','05112000')
DECLARE @MANV NCHAR(5),@SO INT,@TONG INT
SET @TONG = (SELECT COUNT(*) FROM LAODONG)
IF @TONG =0
	BEGIN
		SET @MANV = 'NV001'
	END
ELSE
	BEGIN
		SET @MANV = RIGHT((SELECT MAX(MALD) FROM LAODONG),3)
		SET @SO = CAST(@MANV AS INT)+1
		IF @SO<10
			SET @MANV = 'NV00'+CAST(@SO AS nvarchar(3))
		ELSE IF @SO>=10 AND @SO <100
			SET @MANV = 'NV0'+CAST(@SO AS nvarchar(3))
		ELSE IF @SO>=100
			SET  @MANV = 'NV'+CAST(@SO AS nvarchar(3))
	END
SELECT @MANV

DECLARE @MACT NCHAR(5),@SOCT INT,@TONGCT INT
SET @TONGCT = (SELECT COUNT(*) FROM CONGTRINH)
IF @TONGCT =0
	BEGIN
		SET @MACT = 'CT001'
	END
ELSE
	BEGIN
		SET @MACT = RIGHT((SELECT MAX(MACT) FROM CONGTRINH),3)
		SET @SOCT = CAST(@MACT AS INT)+1
		IF @SOCT<10
			SET @MACT = 'CT00'+CAST(@SOCT AS nvarchar(3))
		ELSE IF @SOCT>=10 AND @SOCT <100
			SET @MACT = 'CT0'+CAST(@SOCT AS nvarchar(3))
		ELSE IF @SOCT>=100
			SET  @MACT = 'CT'+CAST(@SOCT AS nvarchar(3))
	END
SELECT @MACT


DECLARE @MACM NCHAR(5),@SOCM INT,@TONGCM INT
SET @TONGCM = (SELECT COUNT(*) FROM CHUYENMON)
IF @TONGCM =0
	BEGIN
		SET @MACM = 'CM01'
	END
ELSE
	BEGIN
		SET @MACM = RIGHT((SELECT MAX(MACM) FROM CHUYENMON),2)
		SET @SOCM = CAST(@MACM AS INT)+1
		IF @SOCM<10
			SET @MACM = 'CT0'+CAST(@SOCM AS nvarchar(2))
		ELSE IF @SOCM>=10 AND @SOCM <100
			SET @MACM = 'CT'+CAST(@SOCM AS nvarchar(2))
	END
SELECT @MACM




DECLARE @MACT1 NCHAR(5),@MALD1 NCHAR(5),@MACM1 NCHAR(4),@OK1 BIT
SET @MACT1 = 'CT003'
SET @MALD1 = 'NV006'
SET @MACM1 ='CM02'
IF (SELECT MACM FROM LAODONG WHERE MALD=@MALD1)=@MACM1
BEGIN
	IF @MACM1 IN (SELECT MACM FROM LAODONG A join CHITIETCT B ON A.MALD=B.MALD JOIN CONGTRINH C ON B.MACT=C.MACT WHERE C.MACT=@MACT1)
		BEGIN
			SET @OK1 = 1
		END
	ELSE 
		SET @OK1 = 0
END
ELSE
	SET @OK1=0
SELECT @OK1





